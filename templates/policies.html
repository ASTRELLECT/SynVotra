<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company Policies - SynVotra</title>
    
    <link rel="stylesheet" href="/static/css/dashboard.css">
    <link rel="stylesheet" href="/static/css/policies.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar matching dashboard -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>SynVotra</h2>
            </div>
            <nav>
                <div class="menu-item" data-page="dashboard">
                    <i class="fas fa-home"></i> Dashboard
                </div>
                <div class="menu-item" data-page="profile">
                    <i class="fas fa-user"></i> My Profile
                </div>
                <div class="menu-item" data-page="user_management">
                    <i class="fas fa-users"></i> User Management
                </div>
                <div class="menu-item " data-page="announcement">
                    <i class="fas fa-bullhorn"></i> Announcements
                </div>
                <div class="menu-item" data-page="testimonials">
                    <i class="fas fa-comments"></i> Testimonials
                </div>
                <div class="menu-item active" data-page="policies">
                    <i class="fas fa-file-alt"></i> Policies
                </div>
                <div class="menu-item">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </div>
            </nav>
        </aside>

        <main class="main-content">
            <div class="header">
                <h1><i class="fas fa-file-alt"></i> Company Policies</h1>
                <div class="user-info">
                    <div class="user-avatar">
                        <img id="header-avatar-img" src="/static/uploads/avatars/default.png" alt="User Avatar">
                    </div>
                    <span id="user-name">User Name</span>
                    <button class="logout-btn" id="logout-btn">Logout</button>
                </div>
            </div>

            <div class="content-section">
                <div class="action-bar">
                    <div class="search-container">
                        <input type="text" id="policy-search" placeholder="Search policies...">
                        <i class="fas fa-search"></i>
                    </div>
                    <div class="filter-group">
                        <select id="category-filter">
                            <option value="">All Categories</option>
                            <option value="hr">HR</option>
                            <option value="it">IT</option>
                            <option value="finance">Finance</option>
                            <option value="operations">Operations</option>
                            <option value="security">Security</option>
                        </select>
                    </div>
                    <!-- Only visible to admin and manager -->
                    <button id="create-policy-btn" class="btn btn-primary admin-manager-only" style="display: none;">
                        <i class="fas fa-plus"></i> Create Policy
                    </button>
                </div>

                <!-- Loading spinner -->
                <div id="loading" class="loading-spinner" style="margin: 50px auto;"></div>

                <div class="table-container">
                    <table id="policies-table" class="data-table" style="display: none;">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Description</th>
                                <th>Category</th>
                                <th>Version</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="policies-table-body">
                            <!-- Policies will be loaded here -->
                        </tbody>
                    </table>
                </div>

                <div id="no-policies-message" class="no-content-message" style="display: none;">
                    <i class="fas fa-file-alt"></i>
                    <p>No policies found.</p>
                </div>

                <div id="error-message" class="no-content-message error-message" style="display: none;">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p id="error-text">Error loading policies. Please try again later.</p>
                    <button id="retry-btn" class="btn btn-primary" style="margin-top: 15px;">
                        <i class="fas fa-sync"></i> Retry
                    </button>
                </div>

                <div class="pagination" id="pagination" style="display: none;">
                    <button id="prev-page" class="btn btn-outline" disabled>
                        <i class="fas fa-chevron-left"></i> Previous
                    </button>
                    <span id="page-info">Page 1 of 1</span>
                    <button id="next-page" class="btn btn-outline">
                        Next <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- Create Policy Modal - Only for admin and manager -->
    <div id="create-policy-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-plus"></i> Create New Policy</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="create-policy-form">
                    <div class="form-group">
                        <label for="policy-title">Policy Title*</label>
                        <input type="text" id="policy-title" name="title" required>
                    </div>
                    <div class="form-group">
                        <label for="policy-description">Description*</label>
                        <textarea id="policy-description" name="description" rows="4" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="policy-category">Category*</label>
                        <select id="policy-category" name="category" required>
                            <option value="">Select Category</option>
                            <option value="hr">HR</option>
                            <option value="it">IT</option>
                            <option value="safety">Safety</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="policy-document">Document URL*</label>
                        <input type="url" id="policy-document" name="document_url" required>
                    </div>
                    <div class="form-group">
                        <label for="policy-version">Version*</label>
                        <input type="text" id="policy-version" name="version" required>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="policy-active" name="is_active" checked>
                            Active
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary close-modal">Cancel</button>
                <button type="button" id="save-policy" class="btn btn-primary">Create Policy</button>
            </div>
        </div>
    </div>

    <!-- Edit Policy Modal - Only for admin and manager -->
    <!-- Edit Policy Modal -->
    <div id="edit-policy-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-edit"></i> Edit Policy</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="edit-policy-form">
                    <input type="hidden" id="edit-policy-id">

                    <div class="form-group">
                        <label for="edit-policy-title">Policy Title*</label>
                        <input type="text" id="edit-policy-title" name="title" required>
                    </div>

                    <div class="form-group">
                        <label for="edit-policy-category">Category*</label>
                        <select id="edit-policy-category" name="category" required>
                            <option value="">Select Category</option>
                            <option value="hr">HR</option>
                            <option value="it">IT</option>
                            <option value="finance">Finance</option>
                            <option value="operations">Operations</option>
                            <option value="security">Security</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="edit-policy-description">Description*</label>
                        <textarea id="edit-policy-description" name="description" rows="4" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="edit-policy-document">Document URL*</label>
                        <input type="url" id="edit-policy-document" name="document_url" required>
                    </div>

                    <div class="form-group">
                        <label for="edit-policy-version">Version*</label>
                        <input type="text" id="edit-policy-version" name="version" required>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="edit-policy-active" name="is_active">
                            Active
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary close-modal">Cancel</button>
                <button type="button" id="update-policy" class="btn btn-primary">Update Policy</button>
            </div>
        </div>
    </div>

    <!-- View Policy Modal - For all users -->
    <div id="view-policy-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="view-policy-title">Policy Title</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="policy-metadata">
                    <span class="category-badge" id="view-policy-category">Category</span>
                </div>
                <div class="policy-content" id="view-policy-content">
                    Policy content will appear here
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary close-modal">Close</button>
                <!-- Edit button only visible to admin and manager -->
                <button type="button" id="edit-policy-btn" class="btn btn-primary admin-manager-only" style="display: none;">Edit</button>
                <button type="button" id="delete-policy-btn" class="btn btn-danger admin-manager-only" style="display: none;">Delete</button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="modal">
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h2 id="confirm-title">Confirm Action</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p id="confirm-message">Are you sure you want to perform this action?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary close-modal">Cancel</button>
                <button type="button" id="confirm-action" class="btn btn-danger">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <script src="/static/js/policies.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check access token first
            const token = localStorage.getItem('access_token');
            if (!token) {
                window.location.href = '/';
                return;
            }

            // Setup navigation for menu items
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', function() {
                    const menuText = this.textContent.trim().toLowerCase();
                    
                    if (menuText.includes('dashboard')) {
                        window.location.href = '/admin/dashboard';
                    } else if (menuText.includes('profile')) {
                        window.location.href = '/profile';
                    } else if (menuText.includes('user management')) {
                        window.location.href = '/user_management';
                    } else if (menuText.includes('testimonials')) {
                        window.location.href = '/testimonials';
                    } else if (menuText.includes('policies')) {
                        window.location.href = '/policies';
                    } else if (menuText.includes('announcements')) {
                        window.location.href = '/announcement';
                    }
                });
            });

            // Hide menu items based on role
            const userRole = localStorage.getItem('userRole') || '';
            const roleRestrictedItems = document.querySelectorAll('[data-requires-role]');
            
            roleRestrictedItems.forEach(item => {
                const allowedRoles = item.getAttribute('data-requires-role').split(',');
                if (!allowedRoles.includes(userRole.toLowerCase())) {
                    item.classList.add('hidden');
                }
            });
        });
    </script>
</body>
</html>
